<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Fetch API Example</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            padding: 20px;
        }

        button {
            padding: 10px 20px;
            font-size: 16px;
        }

        input[type="text"] {
            padding: 10px;
            font-size: 16px;
            width: 100%;
            margin-top: 20px;
        }

        .image-grid {
        display: flex;
        flex-wrap: wrap;
        gap: 10px; /* 画像の間隔 */
    }

    .image-grid img {
        max-width: 100%; /* 画像の最大幅を100%に設定 */
        height: auto; /* アスペクト比を維持したまま高さを自動調整 */
    }

    /* 画像の数に応じて列数を調整 */
    @media (min-width: 768px) {
        .image-grid {
            width: 100%; /* 横幅いっぱいに広がる */
        }
        .image-grid img {
            width: calc(100% / 3 - 5px); /* 幅が1/3になるように設定（画像間の隙間を考慮） */
        }
    }

    @media (max-width: 767px) {
        .image-grid img {
            width: calc(100% / 2 - 5px); /* 幅が1/2になるように設定（画像間の隙間を考慮） */
        }
    }
    </style>
</head>
<body>
    <input type="text" id="uidInput" placeholder="UIDを入力してください">
    <br>
    <br>
    <button id="fetchButton">データを取得する</button>
    <br>
    <div id="nickname">
    </div>
    <br>
    <br>
    <div class="image-grid" id="imageGrid">
    </div>

    <script>
        const characters = [
            "該当なし", "該当なし", "神里綾華", "ジン", "該当なし", "風男主人公", "リサ", "風女主人公",
            "該当なし", "該当なし", "該当なし", "該当なし", "該当なし", "該当なし", "バーバラ", "ガイア",
            "ディルック", "該当なし", "該当なし", "該当なし", "レザー", "アンバー", "ウェンティ", "香菱",
            "北斗", "行秋", "魈", "凝光", "該当なし", "クレー", "鍾離", "フィッシュル",
            "ベネット", "タルタリヤ", "ノエル", "七七", "重雲", "甘雨", "アルベド", "ディオナ",
            "該当なし", "モナ", "刻晴", "スクロース", "辛炎", "ロサリア", "胡桃", "楓原万葉",
            "煙緋",  "宵宮", "トーマ", "エウルア", "雷電将軍", "早袖", "珊瑚宮心海", "ゴロー",
            "九条裟羅", "荒瀧一斗", "八重神子", "鹿野院平蔵", "夜蘭", "モモカ", "アーロイ", "申鶴",
            "雲菫", "忍", "神里綾人", "コレイ", "ドリー", "ティナリ", "ニィロウ", "セノ",
            "キャンディス", "ナヒーダ", "レイラ", "放浪者", "ファルザン", "ヨォーヨ", "アルハイゼン", "ディシア",
            "ミカ", "カーヴェ", "白朮", "リネット", "リネ", "フレミネ", "リオセスリ", "ヌヴィレット",
            "シャルロット", "フリーナ", "シュヴルーズ", "ナヴィア", "嘉明", "閑雲", "千織"
        ];

        const char_flag = [
            0, 0, 1, 0, 0, 0, 1, 0, 0, 0,
            0, 0, 0, 0, 0, 1, 1, 0, 0, 0,
            1, 1, 0, 1, 1, 1, 1, 1, 0, 1,
            1, 1, 1, 1, 1, 0, 1, 1, 1, 0, 
            0, 0, 1, 0, 1, 1, 1, 0, 1, 1, 
            0, 1, 1, 0, 0, 0, 1, 1, 1, 1, 
            1, 0, 0, 0, 0, 0, 1, 1, 0, 1, 
            1, 1, 0, 1, 0, 1, 1, 0, 1, 1,
            0, 0, 0, 0, 1, 0, 1, 1, 0, 1, 
            0, 1, 1, 0, 0
        ];


        // fetchData() 関数を定義
        async function fetchData() {
            const uid = document.getElementById('uidInput').value.trim(); // 先頭と末尾の空白を削除

            // uidが空白の場合はメッセージを表示して処理を中断
            if (uid === '') {
                const nicknameElement = document.getElementById('nickname');
                nicknameElement.textContent = "UIDを入力してください";
                return;
            }

            const url = `https://asia-northeast1-numeric-cinema-417315.cloudfunctions.net/ImportEnkaApi?uid=${uid}`;

            try {
                const response = await fetch(url);

                if (!response.ok) {
                    throw new Error('Failed to fetch data');
                }
                let char_ids = [];
                const data = await response.json();
                console.log(data);
                // ニックネームをHTMLに出力する
                const nicknameElement = document.getElementById('nickname');
                const avatarIds = data.data.playerInfo.showAvatarInfoList.map(info => info.avatarId);
                console.log(avatarIds);
                nicknameElement.innerHTML = "ユーザーネーム：" + data.data.playerInfo.nickname +
                             "<br>" +
                             "取得アチーブメント数：" + data.data.playerInfo.finishAchievementNum + 
                             "<br>" +
                             "キャラクターID：" + avatarIds;
                
                for (let i = 0; i < avatarIds.length; i++)
                {
                    let charId = parseInt(avatarIds[i]) - 10000000;
                    if(char_flag[charId] == 1)
                    {
                        char_ids.push(characters[charId]);
                    }
                }
                console.log(char_ids);
                
                const images = [
                    { src: "../character/Lyney.webp", alt: "Image 1" },
                    { src: "../character/dehya.webp", alt: "Image 2" },
                    { src: "../character/dehya.webp", alt: "Image 3" }
                ];

                // 画像要素を生成し、動的にHTMLに追加する
                const imageGrid = document.getElementById("imageGrid");
                images.forEach(image => {
                    const imgElement = document.createElement("img");
                    imgElement.src = image.src;
                    imgElement.alt = image.alt;
                    imageGrid.appendChild(imgElement);
                });
            } catch (error) {
                console.error('Error fetching data:', error);
                const nicknameElement = document.getElementById('nickname');
                nicknameElement.textContent = "入力したUIDに問題があるようです。";
                return;
            }
        }

// ボタンをクリックしたときに fetchData() 関数を実行する
document.getElementById('fetchButton').onclick = function() {
    fetchData();
};

    </script>
</body>
</html>
